// Generated by CoffeeScript 1.3.3
var MotionCapture;

MotionCapture = (function() {

  MotionCapture.prototype.gyro = {};

  MotionCapture.prototype.acceleration = {};

  MotionCapture.prototype.orientation = 0;

  function MotionCapture() {
    var _this = this;
    this.resetVars();
    window.addEventListener("deviceorientation", function(e) {
      return _this.onDeviceOrientation(e);
    });
    window.addEventListener("orientationchange", function(e) {
      return _this.onOrientationChange(e);
    });
    window.addEventListener("devicemotion", function(e) {
      return _this.onDeviceMotion(e);
    });
    this.orientation = window.orientation;
    console.log('MotionCapture');
  }

  MotionCapture.prototype.destroy = function() {
    var _this = this;
    window.removeEventListener("deviceorientation", function(e) {
      return _this.onDeviceOrientation(e);
    });
    window.removeEventListener("orientationchange", function(e) {
      return _this.onOrientationChange(e);
    });
    return window.removeEventListener("devicemotion", function(e) {
      return _this.onDeviceMotion(e);
    });
  };

  MotionCapture.prototype.resetVars = function() {
    this.gyro = {
      x: 0,
      y: 0,
      z: 0,
      alpha: 0,
      beta: 0,
      gamma: 0,
      multiplier: 2,
      tilt: 30
    };
    this.acceleration = {
      x: 0,
      y: 0,
      z: 0,
      gx: 0,
      gy: 0,
      gz: 0,
      alpha: 0,
      beta: 0,
      gamma: 0
    };
    return this.orientation = 0;
  };

  MotionCapture.prototype.onDeviceOrientation = function(e) {
    console.log('onDeviceOrientation', e);
    switch (this.orientation) {
      case 90:
        this.gyro.beta = e.beta;
        this.gyro.gamma = -e.gamma - this.gyro.tilt;
        this.gyro.alpha = 180 - (e.alpha + 180) % 360;
        break;
      case 180:
        this.gyro.beta = -e.beta - this.gyro.tilt;
        this.gyro.gamma = e.gamma;
        this.gyro.alpha = 180 - e.alpha % 360;
        break;
      case -90:
        this.gyro.beta = -e.beta;
        this.gyro.gamma = e.gamma - this.gyro.tilt;
        this.gyro.alpha = 180 - (e.alpha + 180) % 360;
        break;
      default:
        this.gyro.beta = e.beta - this.gyro.tilt;
        this.gyro.gamma = e.gamma;
        this.gyro.alpha = 180 - (e.alpha + 180) % 360;
    }
    this.gyro.x = this.gyro.gamma * this.gyro.multiplier;
    this.gyro.y = this.gyro.beta * this.gyro.multiplier;
    return this.gyro.z = this.gyro.alpha;
  };

  MotionCapture.prototype.onOrientationChange = function(e) {
    console.log('window.orientation', window.orientation, e);
    return this.orientation = window.orientation;
  };

  MotionCapture.prototype.onDeviceMotion = function(e) {
    var output;
    console.log('onDeviceMotion', e);
    this.acceleration.x = e.acceleration.x;
    this.acceleration.y = e.acceleration.y;
    this.acceleration.z = e.acceleration.z;
    this.acceleration.gx = e.accelerationIncludingGravity.x;
    this.acceleration.gy = e.accelerationIncludingGravity.y;
    this.acceleration.gz = e.accelerationIncludingGravity.z;
    this.acceleration.alpha = e.rotationRate.alpha;
    this.acceleration.beta = e.rotationRate.beta;
    this.acceleration.gamma = e.rotationRate.gamma;
    output = "";
    output += "x: " + this.acceleration.x + "<br>";
    output += "y: " + this.acceleration.y + "<br>";
    output += "z: " + this.acceleration.z + "<br>";
    output += "gx: " + this.acceleration.gx + "<br>";
    output += "gy: " + this.acceleration.gy + "<br>";
    output += "gz: " + this.acceleration.gz + "<br>";
    output += "alpha: " + this.acceleration.alpha + "<br>";
    output += "beta: " + this.acceleration.beta + "<br>";
    output += "gamma: " + this.acceleration.gamma;
    return $("#debug").html(output);
  };

  return MotionCapture;

})();
