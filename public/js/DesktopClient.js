// Generated by CoffeeScript 1.3.3
var DesktopClient;

DesktopClient = (function() {

  DesktopClient.prototype.threeJS = null;

  function DesktopClient(threeJS) {
    var _this = this;
    this.threeJS = threeJS != null ? threeJS : null;
    this.socket = io.connect();
    this.socket.on("connect", function() {
      return _this.onConnect();
    });
  }

  DesktopClient.prototype.roundTwoDigit = function(num) {
    return Math.round(num * 100) / 100;
  };

  DesktopClient.prototype.onConnect = function() {
    var _this = this;
    this.socket.emit("create-session");
    this.socket.addListener("initial-state", this.onInitState);
    this.socket.addListener("connection-established", function(data) {
      return _this.onConnectionEstablished(data);
    });
    return this.socket.addListener("mobile-receive", function(data) {
      return _this.onMobileReceive(data);
    });
  };

  DesktopClient.prototype.onInitState = function(data) {
    console.log('onInitState', data);
    $("#session-id").append("Scan QR Code or type this code into your phone:  " + data.session);
    return $('#qrcode').qrcode(window.document.location.host + "/mobile.html?sessionID=" + data.session);
  };

  DesktopClient.prototype.onConnectionEstablished = function(data) {
    console.log('onConnectionEstablished', data);
    $('#qrcode').hide();
    return $("#session-id").html("CONNECTED");
  };

  DesktopClient.prototype.onMobileReceive = function(data) {
    var str;
    str = "";
    str += "gyro.x " + this.roundTwoDigit(data.gyro.x) + "<br>";
    str += "gyro.y " + this.roundTwoDigit(data.gyro.y) + "<br>";
    str += "gyro.z " + this.roundTwoDigit(data.gyro.z) + "<br>";
    if (this.threeJS != null) {
      this.threeJS.render(data.acceleration.gamma, data.acceleration.beta, data.acceleration.alpha);
    } else {
      str += "gyro.alpha " + this.roundTwoDigit(data.gyro.alpha) + "<br>";
      str += "gyro.beta " + this.roundTwoDigit(data.gyro.beta) + "<br>";
      str += "gyro.gamma " + this.roundTwoDigit(data.gyro.gamma) + "<br>";
      str += "gyro.multiplier " + this.roundTwoDigit(data.gyro.multiplier) + "<br>";
      str += "gyro.tilt " + this.roundTwoDigit(data.gyro.tilt) + "<br>";
      str += "acceleration.x " + this.roundTwoDigit(data.acceleration.x) + "<br>";
      str += "acceleration.y " + this.roundTwoDigit(data.acceleration.y) + "<br>";
      str += "acceleration.z " + this.roundTwoDigit(data.acceleration.z) + "<br>";
      str += "acceleration.gx " + this.roundTwoDigit(data.acceleration.gx) + "<br>";
      str += "acceleration.gy " + this.roundTwoDigit(data.acceleration.gy) + "<br>";
      str += "acceleration.gz " + this.roundTwoDigit(data.acceleration.gz) + "<br>";
      str += "acceleration.alpha " + this.roundTwoDigit(data.acceleration.alpha) + "<br>";
      str += "acceleration.beta " + this.roundTwoDigit(data.acceleration.beta) + "<br>";
      str += "acceleration.gamma " + this.roundTwoDigit(data.acceleration.gamma) + "<br>";
    }
    return $("#debug").html(str);
  };

  return DesktopClient;

})();
